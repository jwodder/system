---
- stat: path={{certbot_venv}}
  register: lenc

- name: Download certbot-auto
  get_url:
    url: https://dl.eff.org/certbot-auto
    dest: /tmp/certbot-auto
    mode: 0755
    force: true

# Because of the way certbot-auto is written (as of 2016-09-11), using `wget
# -O-` to download & pipe the script to bash in a single task does not work.

- command: /tmp/certbot-auto --noninteractive --version
  when: not lenc.stat.exists or update_certbot
  environment:
    VENV_PATH: "{{certbot_venv}}"

- name: Install symlink at /usr/local/bin/certbot
  file:
    path: /usr/local/bin/certbot
    state: link
    src: "{{certbot_venv}}/bin/certbot"
